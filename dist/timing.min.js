!function(t){Timing=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio),Timing.definition=t,"undefined"!=typeof module&&null!==module?module.exports=Timing:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Timing=Timing:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Timing=Timing)}(function(t){null==t&&(t={});var r,s=t.hasOwnProperty("BaseUpdater")?t.BaseUpdater:require("spark-starter").Updater;return(r=function(){function t(t){this.running=null==t||t,this.children=[]}return t.prototype.addChild=function(t){var i;return i=this.children.indexOf(t),this.updater&&(t.updater.dispatcher=this.updater),-1===i&&this.children.push(t),t.parent=this},t.prototype.removeChild=function(t){var i;return-1<(i=this.children.indexOf(t))&&this.children.splice(i,1),t.parent===this&&(t.parent=null),this},t.prototype.toggle=function(i){return void 0===i&&(i=!this.running),this.running=i,this.children.forEach(function(t){return t.toggle(i)})},t.prototype.setTimeout=function(t,i){var e;return e=new this.constructor.Timer(i,t,this.running),this.addChild(e),e},t.prototype.setInterval=function(t,i){var e;return e=new this.constructor.Timer(i,t,this.running,!0),this.addChild(e),e},t.prototype.pause=function(){return this.toggle(!1)},t.prototype.unpause=function(){return this.toggle(!0)},t}()).Timer=function(){function t(t,i,e,n){this.time=t,this.running=null==e||e,this.repeat=null!=n&&n,this.remainingTime=this.time,this.updater=new r.Updater(this),this.dispatcher=new s,i&&this.dispatcher.addCallback(i),this.running&&this._start()}return t.now=function(){var t;return null!=("undefined"!=typeof window&&null!==window&&null!=(t=window.performance)?t.now:void 0)?window.performance.now():null!=("undefined"!=typeof process&&null!==process?process.uptime:void 0)?1e3*process.uptime():Date.now()},t.prototype.toggle=function(t){return void 0===t&&(t=!this.running),t?this._start():this._stop()},t.prototype.pause=function(){return this.toggle(!1)},t.prototype.unpause=function(){return this.toggle(!0)},t.prototype.getElapsedTime=function(){return this.running?this.constructor.now()-this.startTime+this.time-this.remainingTime:this.time-this.remainingTime},t.prototype.setElapsedTime=function(t){return this._stop(),this.remainingTime=this.time-t,this._start()},t.prototype.getPrc=function(){return this.elapsedTime/this.time},t.prototype.setPrc=function(t){return this.setElapsedTime(this.time*t)},t.prototype._start=function(){return this.running=!0,this.updater.forwardCallbacks(),this.startTime=this.constructor.now(),this.repeat&&!this.interupted?this.id=setInterval(this.tick.bind(this),this.remainingTime):this.id=setTimeout(this.tick.bind(this),this.remainingTime)},t.prototype._stop=function(){var t;return t=this.interupted,this.running=!1,this.updater.unforwardCallbacks(),this.remainingTime=this.time-(this.constructor.now()-this.startTime),this.interupted=this.remainingTime!==this.time,this.repeat&&!t?clearInterval(this.id):clearTimeout(this.id)},t.prototype.tick=function(){var t;return t=this.interupted,this.interupted=!1,this.repeat?this.remainingTime=this.time:this.remainingTime=0,this.dispatcher.update(),this.repeat?t?this._start():this.startTime=this.constructor.now():this.destroy()},t.prototype.destroy=function(){if(this.repeat?clearInterval(this.id):clearTimeout(this.id),this.updater.destroy(),this.dispatcher.destroy(),this.running=!1,this.parent)return this.parent.removeChild(this)},t}(),r.Updater=function(){function t(t){this.parent=t,this.dispatcher=new s,this.callbacks=[]}return t.prototype.addCallback=function(t){var i;if(this.callbacks.includes(t)||this.callbacks.push(t),(null!=(i=this.parent)?i.running:void 0)&&this.dispatcher)return this.dispatcher.addCallback(t)},t.prototype.removeCallback=function(t){var i;if(-1!==(i=this.callbacks.indexOf(t))&&this.callbacks.splice(i,1),this.dispatcher)return this.dispatcher.removeCallback(t)},t.prototype.getBinder=function(){if(this.dispatcher)return new s.Binder(this)},t.prototype.forwardCallbacks=function(){if(this.dispatcher)return this.callbacks.forEach((i=this,function(t){return i.dispatcher.addCallback(t)}));var i},t.prototype.unforwardCallbacks=function(){if(this.dispatcher)return this.callbacks.forEach((i=this,function(t){return i.dispatcher.removeCallback(t)}));var i},t.prototype.destroy=function(){return this.unforwardCallbacks(),this.callbacks=[],this.parent=null},t}(),r});